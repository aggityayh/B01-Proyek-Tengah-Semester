{% extends 'base.html' %}

{% block head %}
    <!-- Add Bootstrap CSS link -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <!-- Optional: Add Bootstrap JavaScript and Popper.js for Bootstrap's JavaScript components -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock head %}
{% block content %}

    <div class="container mt-4">
        <h1>Bookmarks Page</h1>
        <form method="POST">
            {% csrf_token %}
            <div class="row" id="bookmark-list">
                <!-- Use a row to contain multiple cards -->
                {% for bookmark in bookmarks %}
                    <div class="col-md-4">
                        <div class="card mb-4">
                            <div class="card-body">
                                <h3 class="card-title">{{ bookmark.fields.title }}</h3>
                                <p class="card-text">First Name: {{ bookmark.fields.first_name }}</p>
                                <p class="card-text">Last Name: {{ bookmark.fields.last_name }}</p>
                                <p class="card-text">Publication Year: {{ bookmark.fields.year }}</p>
                                <p class="card-text">Language: {{ bookmark.fields.language }}</p>
                                <p class="card-text">Subjects: {{ bookmark.fields.subjects }}</p>
                                <p class="card-text">Categories: {{ bookmark.fields.bookshelves }}</p>
                                <button class="btn btn-danger" onclick="deleteBookmark({{ bookmark.pk }})">Delete</button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </form>
    </div>

    <script>
        // Your JavaScript code here
        async function getBooks() {
                const response = await fetch("{% url 'bookmarks:get_bookmark_json' %}");
                return response.json();
            }

        function deleteBookmark(bookmarkId) {
            console.log("tombol delete dipencet")
            data = {pk:bookmarkId}
            fetch("{% url 'bookmarks:delete_bookmark_ajax' %}", {
                method: 'DELETE',
                body: JSON.stringify(data)
            })
            if (response.ok) {
                refreshBooks();
            } else {
                console.error('Failed to delete bookmark');
            }
        }

        async function refreshBooks() {
            console.log("kerefresh")
            document.getElementById("bookmark-list").innerHTML = ""
            // bookmarkList.innerHTML = "";
            const bookmarks = await getBooks()
            let htmlString = ``
            bookmarks.forEach(bookmark => {
                // const bookmarkDiv = document.createElement("div");
                // bookmarkDiv.classList.add("bookmark");
                htmlString += `
                    <h3>${bookmark.fields.title}</h3>
                    <p>First Name: ${bookmark.fields.first_name}</p>
                    <p>Last Name: ${bookmark.fields.last_name}</p>
                    <p>Publication Year: ${bookmark.fields.year}</p>
                    <p>Language: ${bookmark.fields.language}</p>
                    <p>Subjects: ${bookmark.fields.subjects}</p>
                    <p>Categories: ${bookmark.fields.bookshelves}</p>
                    <button class="delete-bookmark" onclick="deleteBookmark(${bookmark.pk})">Delete</button>
                    <br />
                `
                // bookmarkList.appendChild(bookmarkDiv);
            })
            document.getElementById("bookmark-list").innerHTML = htmlString
        }

        refreshBooks();
    </script>
{% endblock content %}